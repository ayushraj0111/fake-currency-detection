<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Currency Detection web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- GLOBAL VARIABLES & THEME --- */
        :root {
            --accent: #00f2ff;          /* Cyberpunk Cyan */
            --accent-glow: rgba(0, 242, 255, 0.6);
            --success: #10b981;         /* Result: Authentic Green */
            --danger: #ff4d4d;          /* Result: Counterfeit Red */
            --bg-dark: #020617;         /* Deep Space Blue */
            --glass: rgba(7, 13, 28, 0.92); /* Frosted Glass Effect */
            --border-white: rgba(0, 242, 255, 0.3);
        }

        body {
            margin: 0;
            padding: 20px;
            font-family: 'Inter', sans-serif;
            color: #f8fafc;
            background: var(--bg-dark);
            /* Background image with a dark overlay to keep text readable */
            background-image: 
                linear-gradient(rgba(2, 6, 23, 0.85), rgba(2, 6, 23, 0.85)),
                url("{{ url_for('static', filename='images/money_bg.jpg') }}");
            background-size: cover;
            background-attachment: fixed;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        /* --- MAIN UI PANEL --- */
        .container {
            width: 100%;
            max-width: 1100px;
            background: var(--glass);
            backdrop-filter: blur(20px); /* Blurs the background image behind the panel */
            border: 1px solid var(--border-white);
            border-radius: 32px;
            padding: 40px;
            box-shadow: 0 0 40px rgba(0, 242, 255, 0.15);
            margin: auto;
        }

        .header h1 {
            text-align: center;
            font-size: 2.2rem;
            letter-spacing: 8px;
            font-weight: 800;
            /* Gradient text effect */
            background: linear-gradient(135deg, #fff 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 15px var(--accent-glow);
        }

        /* --- THE DROP ZONE (SCAN VAULT) --- */
        .scan-vault {
            position: relative;
            background: rgba(0, 0, 0, 0.5);
            border: 2px dashed var(--accent);
            border-radius: 24px;
            height: 320px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            overflow: hidden;
            transition: 0.3s;
        }

        /* Triggered via JS when a file is hovered over the box */
        .scan-vault.drag-active {
            background: rgba(0, 242, 255, 0.1);
            border-style: solid;
            transform: scale(1.02);
        }

        /* THE ANIMATED SCANNER LINE */
        #scanner-ray {
            display: none; /* Hidden until "Initiate Scan" is clicked */
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 4px;
            background: #fff;
            background: linear-gradient(90deg, transparent, #fff, var(--accent), #fff, transparent);
            box-shadow: 0 0 20px var(--accent), 0 0 35px var(--accent);
            z-index: 10;
        }

        /* Controls the vertical movement of the ray */
        @keyframes scanMove {
            0% { top: 0%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 98%; opacity: 0; }
        }

        #specimen-preview {
            max-width: 90%;
            max-height: 280px;
            display: none; /* Hidden until user selects an image */
            border-radius: 12px;
            z-index: 5;
        }

        /* --- SCAN BUTTON --- */
        .action-btn {
            display: block;
            width: 100%;
            max-width: 400px;
            margin: 30px auto 0;
            background: rgba(255,255,255,0.05);
            color: #64748b;
            border: 1px solid rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 16px;
            font-weight: 700;
            letter-spacing: 2px;
            transition: 0.3s;
        }

        /* "Armed" state: used when a file is loaded and ready to scan */
        .action-btn.armed {
            background: var(--accent);
            color: #000;
            box-shadow: 0 0 25px var(--accent-glow);
            border: none;
            cursor: pointer;
        }

        /* --- RESULTS LAYOUT (ONLY VISIBLE AFTER POST) --- */
        .analysis-display { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
        
        .monitor-frame { 
            background: #000; 
            border: 2px solid #1e293b; 
            padding: 10px; 
            border-radius: 16px; 
            position: relative;
        }

        .monitor-frame img { width: 100%; border-radius: 8px; display: block; filter: brightness(1.1); }

        /* Small tag in the corner of images (e.g., "Original Specimen") */
        .label-overlay {
            position: absolute; top: 15px; left: 15px; 
            background: rgba(0,0,0,0.7); padding: 4px 10px; 
            font-size: 0.6rem; color: var(--accent); border: 1px solid var(--accent);
        }

        /* Feature Audit Grid (The list of security checks) */
        .audit-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 15px; margin-top: 30px; }
        
        .audit-node { 
            background: rgba(255, 255, 255, 0.03); padding: 18px; border-radius: 16px; 
            border: 1px solid rgba(0, 242, 255, 0.1); display: flex; justify-content: space-between; align-items: center; 
        }

        /* Status LED indicators */
        .status-pass { background: var(--success); box-shadow: 0 0 10px var(--success); }
        .status-fail { background: var(--danger); box-shadow: 0 0 10px var(--danger); }

        input[type="file"] { display: none; } /* Hidden: triggered via Label click */

        /* Error shake animation for empty Enter key press */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
    </style>
</head>
<body>

<div class="container">
    <header style="text-align: center; margin-bottom: 40px;">
        <h1>CURRENCY DETECTION</h1>
        <div style="font-size: 0.7rem; color: var(--accent); letter-spacing: 4px; opacity: 0.8; margin-top: 10px;">
            FAKE CURRENCY AUTHENTICATION 
        </div>
    </header>

    <form id="forensic-form" method="POST" enctype="multipart/form-data">
        <label for="specimen-input" class="scan-vault" id="drop-area">
            <div id="scanner-ray"></div>
            
            <div id="instruction-ui" style="text-align: center;">
                <i class="fas fa-fingerprint" style="font-size: 2.5rem; color: var(--accent); margin-bottom: 15px;"></i>
                <p style="font-weight: 700; margin: 0; letter-spacing: 1px;">DEPOSIT SPECIMEN</p>
                <p style="color: #64748b; font-size: 0.8rem;">[ DRAG & DROP OR PRESS ENTER ]</p>
            </div>

            <img id="specimen-preview" src="#">
            <input type="file" name="image" id="specimen-input" accept="image/*" required>
        </label>

        <button type="submit" class="action-btn" id="btn-submit">
            <span id="btn-text">INITIATE DEEP SCAN</span>
        </button>
    </form>

    {% if result and result.error %}
    <div style="margin-top: 30px; padding: 15px; background: rgba(255, 77, 77, 0.2); border: 1px solid var(--danger); border-radius: 12px; color: var(--danger);">
        <strong>ERROR:</strong> {{ result.error }}
    </div>
    {% endif %}

    {% if result %}
    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 50px; border-bottom: 1px solid rgba(0,242,255,0.2); padding-bottom: 15px;">
        <div>
            <h3 style="margin: 0; color: var(--accent);">Analysis Matrix</h3>
            <p style="margin: 5px 0 0; color: #64748b; font-size: 0.8rem;">Timestamp: 2025-12-28 // Node: FX-Core</p>
        </div>
        <div style="padding: 10px 25px; border-radius: 5px; font-weight: 900; background: {{ 'var(--success)' if result.verdict == 'REAL' else 'var(--danger)' }}; color: #000;">
            {{ 'AUTHENTIC' if result.verdict == 'REAL' else 'COUNTERFEIT' }}
        </div>
    </div>

    <div class="analysis-display">
        <div class="monitor-frame">
            <div class="label-overlay">ORIGINAL SPECIMEN</div>
            <img src="{{ url_for('static', filename='uploads/' + result.uploaded_image) }}">
        </div>
        <div class="monitor-frame">
            <div class="label-overlay">FORENSIC ANNOTATION</div>
            <img src="{{ url_for('static', filename='uploads/' + result.annotated_image) }}">
        </div>
    </div>

    <div class="audit-grid">
        {% for info in result.feature_info %}
        <div class="audit-node">
            <div>
                <span style="width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 10px;" class="{{ 'status-pass' if info.status == 'Passed' else 'status-fail' }}"></span>
                <span style="font-size: 0.85rem; color: #94a3b8;">{{ info.name }}</span>
            </div>
            <span style="font-size: 0.7rem; font-weight: 800; color: {{ 'var(--success)' if info.status == 'Passed' else 'var(--danger)' }}">
                {{ 'VERIFIED' if info.status == 'Passed' else 'FAILURE' }}
            </span>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>

<script>
    /* --- DOM ELEMENT REFERENCES --- */
    const fileInput = document.getElementById('specimen-input');
    const preview = document.getElementById('specimen-preview');
    const ui = document.getElementById('instruction-ui');
    const laser = document.getElementById('scanner-ray');
    const form = document.getElementById('forensic-form');
    const btn = document.getElementById('btn-submit');
    const txt = document.getElementById('btn-text');
    const dropArea = document.getElementById('drop-area');

    /* FUNCTION: Updates UI once a file is selected */
    function handleFiles(files) {
        if (files.length > 0) {
            const file = files[0];
            preview.src = URL.createObjectURL(file); // Creates a temporary URL for the image
            preview.style.display = "block";         // Show image
            ui.style.display = "none";               // Hide "Drop here" text
            btn.classList.add('armed');              // Light up the scan button
            dropArea.classList.remove('drag-active');
        }
    }

    /* Event: Standard file selection via click */
    fileInput.onchange = () => handleFiles(fileInput.files);

    /* --- DRAG AND DROP ENGINE --- */
    /* Prevents browser from just opening the image in a new tab */
    ['dragenter', 'dragover'].forEach(eventName => {
        dropArea.addEventListener(eventName, (e) => {
            e.preventDefault();
            e.stopPropagation();
            dropArea.classList.add('drag-active');
        }, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, (e) => {
            e.preventDefault();
            e.stopPropagation();
            dropArea.classList.remove('drag-active');
        }, false);
    });

    /* Event: When user releases mouse over the box */
    dropArea.addEventListener('drop', (e) => {
        const files = e.dataTransfer.files;
        fileInput.files = files; // Sync the dropped file with the hidden input
        handleFiles(files);
    }, false);

    /* --- ACCESSIBILITY: ENTER KEY LOGIC --- */
    window.addEventListener('keydown', (e) => {
        if (e.key === "Enter") {
            if (fileInput.files.length > 0) {
                e.preventDefault();
                form.requestSubmit(); // Submit form if image is ready
            } else {
                // Visual feedback if user hits enter with no file
                dropArea.style.animation = "shake 0.4s ease-in-out";
                setTimeout(() => dropArea.style.animation = "", 400);
            }
        }
    });

    /* --- SUBMISSION & SCANNING ANIMATION --- */
    form.onsubmit = (e) => {
        e.preventDefault(); // Stop immediate submission to show animation
        
        laser.style.display = "block";
        // 'alternate' makes the laser bounce up and down
        laser.style.animation = "scanMove 1.2s infinite alternate ease-in-out";
        
        btn.style.opacity = "0.5";
        btn.style.pointerEvents = "none"; // Prevent double clicking
        txt.innerHTML = '<i class="fas fa-sync fa-spin"></i> ANALYZING NOTE...';
        
        // Artificial delay (2.5s) to make the scan look "calculated"
        setTimeout(() => {
            form.submit(); // Finally send data to the server
        }, 2500); 
    };
</script>

</body>
</html>